project(libFileRevisorTests)
include(${CMAKE_SOURCE_DIR}/CMakeMacros.cmake)

set(CMAKE_INCLUDE_CURRENT_DIR ON)
include_directories(${CMAKE_SOURCE_DIR})
include_directories(${ZenUnitAndMetalMockIncludeDirectory})

folder_source_group(Components)
folder_source_group_subfolder(Components FileRevisor)
folder_source_group_subsubfolder(Components FileRevisor MetalMock)
folder_source_group_subfolder(Components SubPrograms)
folder_source_group_subsubfolder(Components SubPrograms MetalMock)
folder_source_group_subfolder(Components ErrorHandling)
folder_source_group_subsubfolder(Components ErrorHandling MetalMock)
folder_source_group_subfolder(Components Exceptions)
folder_source_group_subsubfolder(Components Exceptions MetalMock)
folder_source_group_subfolder(Components Extension)
folder_source_group_subsubfolder(Components Extension MetalMock)
folder_source_group_subfolder(Components FileSystem)
folder_source_group_subsubfolder(Components FileSystem IntegrationTests)
folder_source_group_subsubfolder(Components FileSystem MetalMock)
folder_source_group_subsubfolder(Components FileSystem ZenUnit)
folder_source_group_subfolder(Components Process)
folder_source_group_subsubfolder(Components Process ZenUnit)
folder_source_group_subsubfolder(Components Process Windows)
folder_source_group_subsubsubfolder(Components Process Windows MetalMock)
folder_source_group_subfolder(Components Random)

folder_source_group_subfolder(Components Utility)
folder_source_group_subsubfolder(Components Utility MetalMock)
folder_source_group_subsubfolder(Components Utility Assertion)
folder_source_group_subsubsubfolder(Components Utility Assertion MetalMock)
folder_source_group_subsubfolder(Components Utility Console)
folder_source_group_subsubsubfolder(Components Utility Console MetalMock)
folder_source_group_subsubfolder(Components Utility DataStructures)
folder_source_group_subsubsubfolder(Components Utility DataStructures MetalMock)
folder_source_group_subsubfolder(Components Utility Docopt)
folder_source_group_subsubsubfolder(Components Utility Docopt MetalMock)
folder_source_group_subsubsubfolder(Components Utility Docopt ZenUnit)
folder_source_group_subsubfolder(Components Utility FunctionCallers)
folder_source_group_subsubsubfolder(Components Utility FunctionCallers Member)
folder_source_group_subsubsubsubfolder(Components Utility FunctionCallers Member MetalMock)
folder_source_group_subsubsubfolder(Components Utility FunctionCallers NonMember)
folder_source_group_subsubsubsubfolder(Components Utility FunctionCallers NonMember MetalMock)
folder_source_group_subsubsubfolder(Components Utility FunctionCallers TryCatchCallers)
folder_source_group_subsubsubsubfolder(Components Utility FunctionCallers TryCatchCallers MetalMock)
folder_source_group_subsubfolder(Components Utility Iteration)
folder_source_group_subsubsubfolder(Components Utility Iteration Counter)
folder_source_group_subsubsubsubfolder(Components Utility Iteration Counter MetalMock)
folder_source_group_subsubsubfolder(Components Utility Iteration ForEach)
folder_source_group_subsubsubsubfolder(Components Utility Iteration ForEach MetalMock)
folder_source_group_subsubsubfolder(Components Utility Iteration Math)
folder_source_group_subsubsubsubfolder(Components Utility Iteration Math MetalMock)
folder_source_group_subsubsubfolder(Components Utility Iteration Transform)
folder_source_group_subsubsubsubfolder(Components Utility Iteration Transform MetalMock)
folder_source_group_subsubfolder(Components Utility Strings)
folder_source_group_subsubsubfolder(Components Utility Strings MetalMock)
folder_source_group_subsubfolder(Components Utility Threading)
folder_source_group_subsubfolder(Components Utility Time)
folder_source_group_subsubsubfolder(Components Utility Time MetalMock)
folder_source_group_subsubsubfolder(Components Utility Time ZenUnit)
folder_source_group_subfolder(Components Windows)
folder_source_group_subfolder(Components ZenUnit)
folder_source_group(Constants)
folder_source_group(Enums)
folder_source_group(Exceptions)
folder_source_group_subfolder(Exceptions ZenUnit)
folder_source_group(StaticUtilities)
folder_source_group_subfolder(Utilities MetalMock)
folder_source_group(ValueTypes)
folder_source_group_subfolder(ValueTypes ZenUnit)

file(GLOB_RECURSE Sources *.h *.cpp)
source_group("" FILES ${Sources})

add_executable(libFileRevisorTests ${Sources})
target_link_libraries(libFileRevisorTests libFileRevisor)
if(UNIX)
   target_precompile_headers(libFileRevisorTests PRIVATE pch.h)

   set_target_properties(libFileRevisorTests PROPERTIES UNITY_BUILD ON)
   set_target_properties(libFileRevisorTests PROPERTIES UNITY_BUILD_BATCH_SIZE 8)

   target_link_libraries(libFileRevisorTests stdc++fs)
elseif(MSVC)
   IfMSVCEnablePrecompiledHeaders()
   replace(CMAKE_CXX_FLAGS_RELWITHDEBINFO "/O2" "/Od")
   replace(CMAKE_CXX_FLAGS_RELWITHDEBINFO "/Ob2" "/Ob0")
   replace(CMAKE_EXE_LINKER_FLAGS_DEBUG "/debug" "/DEBUG:FASTLINK")
   replace(CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO "/debug" "")

   set_target_properties(libFileRevisorTests PROPERTIES UNITY_BUILD ON)
   set_target_properties(libFileRevisorTests PROPERTIES UNITY_BUILD_BATCH_SIZE 8)
   append(CMAKE_CXX_FLAGS "/FIpch.h")

   IfMSVCAddRunTestsPostBuildStep()
endif()

if(UNIX)
   if(LCovCodeCoverageMode)
     target_link_libraries(libFileRevisorTests CodeCovLibraryInterface)
   endif()
endif()
